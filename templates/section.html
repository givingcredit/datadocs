{% extends "base.html" %}
{% block title %}
  {% if section.title %}
    {{section.title}}
  {% else %}
    {{section.name}}
  {% endif %}
{% endblock %}
{% block search %}
  {{search}}
{% endblock %}
{% block sections %}
  {{sections}}
{% endblock %}
{% block content %}

<div class="meta-container">
  <div class="meta-title">
    {{section.title}}
    <div style="text-align: center;">
      <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#toc">
        Table of contents
      </button>
    </div>
  </div>
  <div class="meta-description">{{section.description}}</div>
</div>

<!-- optional markdown content -->
{% if content %}
{{content|safe}}
{% endif %}

<!-- table of contents -->
<div class="modal fade" id="toc" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Table of contents</h4>
      </div>
      <div class="modal-body">
        {% for table in section.categories %}
          <h3>
            <a href="#table-{{loop.index}}" class="toc-link scroll-to-location">{{table.title}}</a>
            <span class="badge">{{table.fields|length}}</span>
          </h3>
          <p style="margin-left: 10px;">{{table.description}}</p>
        {% endfor %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
// after clicking a table link in the TOC, close the modal
$("a.toc-link").click(function(){
  $('#toc').modal('hide')
});
</script>

{% for table in section.tables %}
{% set table_loop = loop %}
<div class="row table-container">
  <div class="col-md-3">
    <section id="table-{{table_loop.index}}">
      <h2>{{table.title}}</h2>
      <div class="">
        <code>{{table.name}}</code>
      </div>
      <p class="table-description">{{table.description}}</p>
    </section>
  </div>
  <div class="col-md-9">
    <table class="table">
      <thead>
        <tr>
          <th></th>
          <th>Field</th>
          <th>Description</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        {% for field in table.fields %}
        <tr class="field">
          <td>
            <section id="field-{{table_loop.index}}-{{loop.index}}">
              {% if field.private %} <i class="fa fa-lock" title="Field is private"></i>{% endif %}
              {% if field.transformed %} <i class="fa fa-edit" title="Field is transformed or calculated"></i>{% endif %}
            </section>
          </td>
          <td>
            <code>{{field.name}}</code>
          </td>
          <td>{{field.description}}</td>
          <td>
            {% if field.dataType == "Boolean" %}
              <i class="fa fa-toggle-off" title="Boolean"></i>
            {% elif field.dataType == "Date" %}
              <i class="fa fa-calendar" title="Date"></i>
            {% elif field.dataType == "Text" %}
              <i class="fa fa-paragraph" title="Text"></i>
            {% elif field.dataType == "Categorical" %}
              <i class="fa fa-list-ul" title="Text"></i>
            {% elif field.dataType == "Numeric" %}
              <i class="fa fa-hashtag" title="Numeric"></i>
            {% elif field.dataType == "JSON" or field.dataType == "YAML" %}
              <i class="fa fa-code" title="Code"></i>
            {% endif %}
              {{field.dataType}}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endfor %}

{% endblock %}
